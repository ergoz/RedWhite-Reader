<!DOCTYPE html> 
<html> 
	<head> 
	<meta charset="utf-8">
	
    <title> RedWhiteReader </title> 

    <link rel="stylesheet" href="./system/jquery.mobile-1.2.0-alpha.1.min.css" />
    <link rel="stylesheet" href="./system/redwhite.min.css" />
    <link rel="stylesheet" href="./system/style.css" />

    <script type="text/javascript" charset="utf-8" src="./system/jquery-latest.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="./system/jquery.mobile-1.2.0-alpha.1.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="./cordova.js"></script>
	<script type="text/javascript" charset="utf-8" src="./system/jquery.eds.progressbar.js"></script>
	
	<script>
	
	
$(document).ready(function(){	

		var DB = window.localStorage;	
		DB.setItem('litenews', "");
		DB.setItem('fullnews', "");
		DB.setItem('twcontent', "");
		DB.setItem('tables', "");
		
		function is_system() {
			var System = DB.getItem("systype");
			var status = false;
			if(System == "phone"){
				status = true;
			}
			if(System == "tablet"){
				status = true;
			}
			return status;
		}

		function GetSystem() {
			Systype = DB.getItem("systype");
			if(Systype == "phone"){
				location.replace("./phone/index.html");
			}
			if(Systype == "tablet"){
				location.replace("./tablet/index.html");
			}
		}	
		
		
		
		function load_content() {
		<!-- ГРУЗИМ НОВОСТИ -->
			$.ajax({
				type: "GET",
				url: "http://ergoz.ru/rwreader/rw-rss.xml",
				dataType: "xml",
				timeout: 15000,
				async: false,
				crossDomain: true,
				success: xmlParser,
				error:xmlError
			});
	
				function xmlParser(xml) {
					var counter = 0;
					var litenews = "";
					var fullnews = "";
						$(xml).find("item").each(function () {							
							litenews = litenews + '<li><a href="./detail.html?nid='+ counter + '" data-ajax="false">' + $(this).find("title").text() + '</a></li>';
							fullnews = fullnews + '<div id="nid'+counter+'">' + $(this).find("yadetail").text() + '</div-last>';
							counter=counter+1;
						});
						DB.setItem('litenews', litenews);
						DB.setItem('fullnews', fullnews);	
						set_progress("30");
						$(".progress-console").html("Новости загружены");	
					}
	
					function xmlError(xml) {
						alert("Error Loading News"); 
					}
		
		<!-- ГРУЗИМ ТВИТТЕР -->
		$.ajax({
				type: "GET",
				url: "https://twitter.com/statuses/user_timeline/fcsm_official.rss",
				dataType: "xml",
				timeout: 30000,
				crossDomain: true,
				async: false,
				success: TWxmlParser,
				error: TWxmlError
			});
		
				function TWxmlParser(xml) {
					var counter = 0;
					var twcontent = "";
						$(xml).find("item").each(function () {							
							twcontent = twcontent + '<li><a href="' + $(this).find("link").text() + '"><h1>' + $(this).find("title").text() + '</h1><p>' + $(this).find("pubDate").text() + '</p></a></li>';
						});
						DB.setItem('twcontent', twcontent);
						set_progress("40");			
						$(".progress-console").html("Twitter лента загружена");	
					}

				function TWxmlError(xml) {
						alert("Error Loading Twitter"); 
				}		

		<!-- ГРУЗИМ ТАБЛИЦЫ -->
		set_progress("50");
		$(".progress-console").html("Загрузка таблиц чемпионата России");	

		<!-- ГРУЗИМ YOUTUBE -->
		set_progress("60");
		$(".progress-console").html("Загрузка таблиц чемпионата России");	

		<!-- ГРУЗИМ ТРАНСЛЯЦИИ -->
		set_progress("70");
		$(".progress-console").html("Загрузка таблиц чемпионата России");	

		<!-- ГРУЗИМ РАСПИСАНИЕ -->
		set_progress("80");
		$(".progress-console").html("Загрузка рекламы");	

		<!-- ГРУЗИМ РЕКЛАМУ -->
		$.get('http://ergoz.ru/rwreader/ads.php', function(data) {
			DB.setItem("ads", data);	
		});
		set_progress("90");
		$(".progress-console").html("Реклама загружена");

		<!-- ГРУЗИМ ЕЩЁ ЧТО-ТО -->
		set_progress("100");
		$(".progress-console").html("Загрузка завершена");	
		}
		

		
		function SetPadSystem() {
			DB.setItem("systype", "tablet");
			GetSystem();
		}
		
		
				
		function SetPhoneSystem() {
			DB.setItem("systype", "phone");
			GetSystem();
		}	

		
	if(is_system()) {
		set_progress("5");
		$(".progress-console").html("Проверка конфигурации");		
		load_content();
		GetSystem();
	} else {
		set_progress("5");
		$(".progress-console").html("Проверка конфигурации");		
		$(".first-run").css("display","block");
		load_content();
	}						
});
   </script>
   
</head> 
	<body>
			<header data-role="header" data-theme="a" data-position="fixed">  
					<a data-rel="back" data-icon="home" data-iconpos="notext" data-direction="reverse">Назад</a>
					<h1>Red White Reader</h1>
					<a href="#exitDialog" data-rel="popup" data-rel="back" data-icon="delete" data-iconpos="notext" data-position-to="window" data-role="button" data-inline="true" data-transition="pop">Выход</a>
						<div data-role="popup" id="exitDialog" data-overlay-theme="a" data-theme="a" style="max-width:400px;" class="ui-corner-all">
							<div data-role="header" data-theme="a" class="ui-corner-top">
								<h1>Выход</h1>
							</div>
							<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content">
								<h3 class="ui-title">Вы уверены что хотите выйти?</h3>
								<center>
									<div style="margin-left:-15px;"><ads></ads></div>
									<a href="#" data-role="button" data-inline="true" data-rel="back" data-theme="a">Отмена</a>    
									<a href="#" onclick="navigator.app.exitApp()" data-role="button" data-inline="true" data-transition="flow" data-theme="a">Выход</a>
								</center>
							</div>
						</div>	
			</header>
		
		
		
			<div data-role="content" data-theme="a" >
				<style>
					.ui-icon-rw-phone {
						background-image: url("./system/images/phone.png");
						width: 16px; 
						height: 28px;
						border-radius: 0px;
						margin-top: -15px !important;
					}
					.ui-icon-rw-pad {
						background-image: url("./system/images/pad.png");
						width: 22px; 
						height: 28px;
						border-radius: 0px;
						margin-top: -15px !important;
					}
				</style>
	
	
				<div class="loading-content">
					<center>
					<h3>Загрузка контента</h3>
					<div class="progress-console" style="font-size: 0.70em !important;">Загрузка контента</div>
					</center>
					<div class="progressbar"><div></div><span>0%</span></div>				
				</div>
	
				<div class="first-run" style="display:none;"><center>
					<h3>Первый запуск приложения</h3>
					<p> Вы впервые запускаете наше приложение. Поэтому просим выбрать тип вашего устройства. 
					Это необходимо для правильного выбора интерфейса. После выбора это окно больше появляться не будет. 
					Однако вы можете изменить тип устройства вы сможете изменить в меню настроек.
					</p>
					
					<a onclick="SetPadSystem();" href="#" id="pad" data-role="button" data-icon="rw-pad">Tablet Pads</a>
					
					<a onclick="SetPhoneSystem();" href="#" id="phone" data-role="button" data-icon="rw-phone">SmartPhone</a>
				</center>
				</div>
			</div>
			
			
			<footer data-role="footer" data-position="fixed">  
				<div style="margin-left:-15px;"><ads></ads></div>
			</footer>
		
	</body>
</html>
